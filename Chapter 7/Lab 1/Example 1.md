 Chapter 7: Lab Example 1

 Laboratory Exercise: Exploring TMS Mechanisms and Effects Using Python

 Objective
This exercise aims to help students understand the mechanisms and effects of Transcranial Magnetic Stimulation (TMS) through simulation and analysis using Python. Students will simulate the magnetic field distribution generated by a TMS coil and analyze the induced electric currents in cortical neurons.

 Materials Needed
- Python programming environment (e.g., Jupyter Notebook)
- Python libraries: NumPy, Matplotlib, SciPy

 Instructions

 1. Setting Up the Environment
Install the necessary Python libraries if not already installed.

```bash
!pip install numpy matplotlib scipy
```

 2. Simulating the TMS Coil Magnetic Field
The following code simulates the magnetic field generated by a figure-eight TMS coil.

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.constants import mu_0

def magnetic_field(x, y, coil_radius=0.05, current=1.0):
     Magnetic field calculation for a figure-eight coil
    Bx = mu_0 * current * coil_radius**2 / (2 * ((x - coil_radius)**2 + y**2)**(3/2))
    By = mu_0 * current * coil_radius**2 / (2 * (x**2 + (y - coil_radius)**2)**(3/2))
    return Bx, By

 Create a grid of points
x = np.linspace(-0.1, 0.1, 400)
y = np.linspace(-0.1, 0.1, 400)
X, Y = np.meshgrid(x, y)

 Calculate the magnetic field components
Bx, By = magnetic_field(X, Y)

 Plot the magnetic field distribution
plt.figure(figsize=(8, 6))
plt.streamplot(X, Y, Bx, By, color=np.sqrt(Bx**2 + By**2), linewidth=1.5)
plt.title('Magnetic Field Distribution of TMS Coil')
plt.xlabel('x (meters)')
plt.ylabel('y (meters)')
plt.colorbar(label='Magnetic Field Strength (Tesla)')
plt.show()
```

 3. Simulating Induced Electric Currents
The induced electric currents in the cortical neurons can be simulated using the curl of the magnetic field.

```python
def electric_field(Bx, By, dx):
     Calculate the electric field from the curl of the magnetic field
    Ex = np.gradient(By, dx, axis=1)
    Ey = -np.gradient(Bx, dx, axis=0)
    return Ex, Ey

 Calculate the electric field components
dx = x[1] - x[0]
Ex, Ey = electric_field(Bx, By, dx)

 Plot the electric field distribution
plt.figure(figsize=(8, 6))
plt.streamplot(X, Y, Ex, Ey, color=np.sqrt(Ex**2 + Ey**2), linewidth=1.5)
plt.title('Induced Electric Field Distribution')
plt.xlabel('x (meters)')
plt.ylabel('y (meters)')
plt.colorbar(label='Electric Field Strength (V/m)')
plt.show()
```

 4. Analyzing the Results

Figure 7.7: Laboratory Exercise Result 1: Magnetic Field Distribution

In this lab exercise, the simulation results are visualized in Figures 7.7 and 7.8, which depict the magnetic field distribution generated by a TMS coil and the corresponding induced electric field in cortical neurons. 

- **Figure 7.7** illustrates the magnetic field distribution, showing that the field is concentrated around the coil, with the strongest intensity near the center and gradually decreasing with distance.
- **Figure 7.8** presents the induced electric field, which is derived from the curl of the magnetic field. The patterns in the electric field reflect the design of the coil, with the distribution playing a critical role in neuronal activation. The variations in the electric field's intensity and focality are key factors that can influence the effectiveness and outcomes of TMS therapy.

 
 


 Extension
For advanced students, modify the simulation to explore different coil configurations (e.g., circular coil, double cone coil) and their effects on the magnetic and electric field distributions. Additionally, simulate the effects of varying stimulation parameters such as frequency and intensity on the induced electric fields.

By the end of this exercise, students should have a better understanding of the physical principles underlying TMS and how these principles translate into neuronal activation, contributing to the therapeutic effects observed in clinical settings.
